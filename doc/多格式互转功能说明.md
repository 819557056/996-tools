# 多格式互转矩阵功能说明

## 📋 项目概述

本次实施完成了三个强大的数据格式处理工具，全面支持多种格式之间的转换、编辑和高级操作。

---

## ✨ 已完成的功能

### 1. 格式互转工具 (Format Converter)

**路径**: `/tools/format-converter`

#### 支持的格式
- ✅ JSON (JavaScript Object Notation)
- ✅ YAML (YAML Ain't Markup Language)
- ✅ TOML (Tom's Obvious, Minimal Language)
- ✅ XML (Extensible Markup Language)
- ✅ CSV (Comma-Separated Values)
- ✅ INI (Initialization File)
- ✅ Properties (Java Properties File)

#### 核心功能
- **双向转换**: 支持任意两种格式之间的互转（7×7=49种转换路径）
- **双编辑器布局**: 左侧源格式，右侧目标格式，实时预览
- **自动转换模式**: 启用后，输入内容自动转换
- **格式化功能**: 美化源数据和目标数据
- **快捷转换**: 常用转换组合一键切换
- **文件下载**: 支持下载转换结果
- **智能提示**: 针对每种格式提供使用说明

#### 技术实现
```
FormatConverter/
├── types.ts                    # 类型定义
├── converters/
│   ├── index.ts               # 统一转换引擎
│   ├── jsonConverter.ts       # JSON 转换器
│   ├── yamlConverter.ts       # YAML 转换器
│   ├── tomlConverter.ts       # TOML 转换器
│   ├── xmlConverter.ts        # XML 转换器
│   ├── csvConverter.ts        # CSV 转换器
│   ├── iniConverter.ts        # INI 转换器
│   └── propertiesConverter.ts # Properties 转换器
├── useFormatConverter.ts      # 业务逻辑
└── index.vue                  # UI 组件
```

#### 使用的库
- `json5`: 支持注释的 JSON 解析
- `js-yaml`: YAML 解析和生成
- `@iarna/toml`: TOML 解析和生成
- `fast-xml-parser`: 高性能 XML 处理
- `papaparse`: 强大的 CSV 解析
- `ini`: INI 文件处理

---

### 2. YAML/TOML 编辑器 (YAML/TOML Editor)

**路径**: `/tools/yaml-toml-editor`

#### 核心功能

##### 实时语法校验 ✓
- 输入即校验，实时反馈错误
- 精确显示错误行号和列号
- 支持多个错误同时显示
- 错误信息清晰易懂

##### YAML 缩进检测 ✓
- 自动检测 Tab 缩进（不推荐）
- 检查缩进是否为 2 的倍数
- 显示期望缩进和实际缩进
- 一键修复所有缩进问题

##### 智能格式化
- 自动规范缩进
- 优化行宽（120字符）
- 保持数据结构清晰
- 去除多余空行

##### 格式互转
- YAML ↔ TOML 双向转换
- 导出为 JSON 格式
- 从 JSON 导入数据
- 保持数据完整性

##### 编辑器功能
- 语法高亮
- 折叠/展开
- 行号显示
- 空格可视化
- 统计信息（行数、字符数、单词数）

#### 状态指示
- 🟢 绿色：格式正确
- 🔴 红色：存在语法错误
- 🟡 黄色：有缩进警告

#### 典型使用场景
1. **Kubernetes 配置**: YAML 配置文件编写和校验
2. **Rust Cargo.toml**: 项目配置管理
3. **Docker Compose**: 服务编排文件
4. **配置文件转换**: 不同格式配置文件互转

---

### 3. CSV 高级操作工具 (CSV Advanced Tools)

**路径**: `/tools/csv-advanced`

#### 功能模块

##### 📊 CSV 分割
**按行数分割**
- 设置每个文件的行数
- 自动保留表头
- 生成多个独立文件

**按文件大小分割**
- 设置每个文件大小（KB）
- 智能分配数据行
- 确保文件不超限

**批量下载**
- 一键下载所有分割文件
- 自动命名（part_1.csv, part_2.csv...）
- 显示每个文件大小

##### 🔄 列提取与重排
**列选择**
- 可视化选择需要的列
- 支持多选/取消选择
- 实时预览选中列

**列重命名**（扩展功能）
- 可自定义新列名
- 保持数据关联

**列排序**（扩展功能）
- 拖拽调整列顺序
- 灵活组织输出结构

**导出**
- 生成新的 CSV 文件
- 仅包含选中的列
- 保持数据完整

##### 💾 转 SQL Insert 语句

**单条插入模式**
```sql
INSERT INTO users (id, name, age) VALUES (1, '张三', 30);
INSERT INTO users (id, name, age) VALUES (2, '李四', 25);
```

**批量插入模式**
```sql
INSERT INTO users (id, name, age)
VALUES
  (1, '张三', 30),
  (2, '李四', 25),
  (3, '王五', 35);
```

**智能特性**
- 自动处理 NULL 值
- 单引号转义
- 数字类型识别
- 可配置批量大小
- 支持自定义表名

##### 📈 数据预览
- 表格形式显示前 5 行
- 实时统计信息
  - 总行数
  - 列数
  - 文件大小
- 列名清晰展示

---

## 🎯 功能矩阵对比

| 功能 | 格式互转 | YAML/TOML编辑器 | CSV高级操作 |
|------|---------|----------------|------------|
| 格式数量 | 7种 | 2种 | 1种 |
| 实时校验 | ✓ | ✓✓ | ✓ |
| 语法高亮 | ✓ | ✓ | - |
| 缩进检测 | - | ✓ (YAML) | - |
| 格式化 | ✓ | ✓ | - |
| 文件分割 | - | - | ✓ |
| 列操作 | - | - | ✓ |
| SQL生成 | - | - | ✓ |
| 批量下载 | - | - | ✓ |

---

## 🚀 快速开始

### 启动开发服务器
```bash
pnpm dev
```

访问: **http://localhost:3001**

### 测试格式互转
1. 点击侧边栏"格式互转"
2. 点击"示例"加载示例数据
3. 选择目标格式（如 YAML）
4. 点击"转换"查看结果
5. 启用"自动转换"体验实时转换

### 测试 YAML 编辑器
1. 点击侧边栏"YAML/TOML 编辑器"
2. 点击"示例"加载 Kubernetes 配置
3. 观察实时语法校验
4. 故意破坏缩进，查看警告提示
5. 点击"修复缩进"自动修复

### 测试 CSV 操作
1. 点击侧边栏"CSV 高级操作"
2. 点击"示例"加载示例数据
3. 点击"解析 CSV"
4. 测试三个功能：
   - **分割**: 设置每100行，点击"开始分割"
   - **列操作**: 选择部分列，点击"提取选中列"
   - **转SQL**: 输入表名，点击"生成 SQL"

---

## 📦 依赖包

新安装的核心依赖：

```json
{
  "dependencies": {
    "js-yaml": "^4.1.0",
    "@iarna/toml": "^2.2.5",
    "fast-xml-parser": "^4.3.3",
    "papaparse": "^5.4.1",
    "ini": "^4.1.1",
    "properties-parser": "^0.3.1"
  },
  "devDependencies": {
    "@types/js-yaml": "^4.0.9",
    "@types/papaparse": "^5.3.14"
  }
}
```

---

## 🎨 用户界面特点

### 一致的设计语言
- 所有工具使用统一的 UI 组件
- 清晰的视觉层次
- 响应式布局
- 深色模式支持

### 交互体验
- 实时反馈
- 加载状态指示
- 友好的错误提示
- 一键复制/下载

### 性能优化
- 异步加载 Monaco 编辑器
- 防抖处理用户输入
- 大文件处理优化
- 内存管理优化

---

## 🔧 技术架构

### 转换引擎设计
```typescript
// 统一的转换接口
interface Converter {
  parse: (input: string) => any        // 解析为中间格式
  stringify: (data: any) => string     // 从中间格式生成
  validate: (input: string) => boolean // 验证格式
}

// 转换流程
输入格式 -> parse() -> 中间数据结构 -> stringify() -> 输出格式
```

### 中间数据结构
使用 JavaScript 原生对象作为中间格式：
- 对象 → `{ key: value }`
- 数组 → `[item1, item2]`
- 基本类型 → `string | number | boolean | null`

这样确保了所有格式之间的互转兼容性。

---

## 📝 使用示例

### 示例 1: JSON 转 YAML (Kubernetes配置)

**输入 (JSON)**:
```json
{
  "apiVersion": "v1",
  "kind": "Pod",
  "metadata": {
    "name": "nginx",
    "labels": {
      "app": "web"
    }
  },
  "spec": {
    "containers": [
      {
        "name": "nginx",
        "image": "nginx:1.21",
        "ports": [{ "containerPort": 80 }]
      }
    ]
  }
}
```

**输出 (YAML)**:
```yaml
apiVersion: v1
kind: Pod
metadata:
  name: nginx
  labels:
    app: web
spec:
  containers:
    - name: nginx
      image: nginx:1.21
      ports:
        - containerPort: 80
```

### 示例 2: CSV 转 SQL

**输入 (CSV)**:
```csv
id,name,email,age
1,张三,zhang@example.com,30
2,李四,li@example.com,25
```

**输出 (SQL - 批量插入)**:
```sql
INSERT INTO users (id, name, email, age)
VALUES
  (1, '张三', 'zhang@example.com', 30),
  (2, '李四', 'li@example.com', 25);
```

---

## ⚠️ 注意事项

### YAML 编辑
- 必须使用空格缩进（不要使用 Tab）
- 推荐使用 2 个空格作为缩进单位
- 冒号后必须有空格
- 注意列表项的对齐

### CSV 处理
- 确保数据格式一致
- 大文件可能需要较长处理时间
- SQL 生成时注意数据类型
- 特殊字符会自动转义

### 格式转换
- 某些格式特性可能不完全兼容
- CSV 只支持扁平结构
- XML 属性会转换为特殊字段
- Properties 格式会展平嵌套对象

---

## 🎓 最佳实践

### 1. 配置文件管理
使用格式互转工具在不同项目配置格式间转换：
- Docker Compose (YAML) ↔ 配置对象 (JSON)
- Rust Cargo (TOML) ↔ Node package (JSON)

### 2. 数据迁移
使用 CSV 工具进行数据准备：
1. 导出 Excel 为 CSV
2. 列提取筛选需要的字段
3. 转换为 SQL Insert
4. 导入数据库

### 3. 配置校验
使用 YAML/TOML 编辑器：
1. 粘贴现有配置
2. 实时查看语法错误
3. 修复缩进问题
4. 格式化输出

---

## 🚧 后续优化建议

### 功能增强
- [ ] 支持更多格式（Protobuf, MessagePack）
- [ ] CSV 批量处理（合并多个文件）
- [ ] YAML 多文档支持
- [ ] SQL 支持更多数据库方言

### 性能优化
- [ ] Web Worker 处理大文件
- [ ] 虚拟滚动支持海量数据
- [ ] 增量解析大型 CSV

### 用户体验
- [ ] 拖放文件上传
- [ ] 历史记录保存
- [ ] 自定义主题
- [ ] 快捷键支持

---

## 📚 相关文档

- [工具开发指南](./工具开发指南.md)
- [快速开始](./快速开始.md)
- [国际化使用说明](./国际化使用说明.md)

---

## ✅ 完成清单

- [x] 安装必要的依赖包
- [x] 创建 FormatConverter 文件结构
- [x] 实现类型定义和转换器接口
- [x] 实现各格式转换器 (JSON/YAML/TOML/XML/CSV/INI/Properties)
- [x] 实现统一转换引擎
- [x] 开发 FormatConverter 主界面组件
- [x] 实现业务逻辑 composable
- [x] 注册工具和配置路由
- [x] 创建 YAML/TOML 编辑器
- [x] 创建 CSV 高级操作工具
- [x] 添加国际化支持
- [x] 测试所有功能
- [x] 撰写功能文档

---

## 🎉 总结

本次实施完成了三个功能强大的数据格式处理工具，涵盖了：

- **7 种格式**的双向互转
- **实时语法校验**和缩进检测
- **CSV 分割、列操作和 SQL 生成**

所有功能均已测试通过，可以投入使用！

**开发服务器地址**: http://localhost:3001

**工具入口**:
- 格式互转: http://localhost:3001/tools/format-converter
- YAML/TOML 编辑器: http://localhost:3001/tools/yaml-toml-editor
- CSV 高级操作: http://localhost:3001/tools/csv-advanced

